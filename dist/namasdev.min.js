/*!
 * namasdev JS
 *
 * @version 1.0.0
 * @author Matias Lopez - https://github.com/MatiasALopez
 * @link https://github.com/MatiasALopez/namasdev.Web.JS
 * @copyright 2024 Matias Lopez
 * @license Released under the MIT license.
 */
"use strict"; var nmd = function () { var e = { stringFormat: function (e, ...t) { if (!e) return e; for (var n = $.isArray(t[0]) ? t[0] : t, a = 0; a < n.length; a++)e = e.replace(new RegExp("\\{" + a + "\\}", "gm"), n[a]); return e }, repeatString: function (e, t) { for (var n = ""; t > 0;)n += e, t--; return n }, throttle: function (e, t, n) { var a, i, o, r = null, s = 0; n || (n = {}); var l = function () { s = !1 === n.leading ? 0 : Date.now(), r = null, o = e.apply(a, i), r || (a = i = null) }; return function () { var c = Date.now(); s || !1 !== n.leading || (s = c); var u = t - (c - s); return a = this, i = arguments, u <= 0 || u > t ? (r && (clearTimeout(r), r = null), s = c, o = e.apply(a, i), r || (a = i = null)) : r || !1 === n.trailing || (r = setTimeout(l, u)), o } }, round: function (e, t) { var n = Math.pow(10, t || 0); return Math.round(e * n) / n }, createDateTimeFromUnixTimestamp: function (e) { return new Date(parseInt(e.match(/\d+/g)[0])) } }, t = function () { var e = "es-ES", t = "numeric", n = "2-digit", a = "2-digit"; function i(a) { return new Date(a).toLocaleDateString(e, { year: t, month: n, day: n }) } function o(t) { return new Date(t).toLocaleTimeString(e, { hour: a, minute: a, hour12: !1 }) } return { formatDate: i, formatTime: o, formatDateTime: function (e) { return i(e) + " " + o(e) }, formatNumber: function (e, t) { return numeral(e).format("0,0." + nmd.utils.repeatString("0", t)) } } }(), n = { print: function () { window.print() }, getQueryStringObject: function () { var e, t = window.location.search.slice(1).split("&"), n = {}, a = t.length; if (window.location.search && a) for (var i = 0; i < a; i++)2 == (e = t[i].split("=")).length && (n[e[0]] = decodeURIComponent(e[1] || "")); return n }, reloadPage: function () { window.location = window.location }, isSmallScreen: function () { return window.matchMedia("(max-width: 767px)").matches }, disableF5Refresh: function () { $(document).on("keydown", (function (e) { return 116 != (e.which || e.keyCode) })) }, disableCopyAndPaste: function (e) { $(e || document).on("cut copy paste", (function (e) { return e.preventDefault(), !1 })) } }, a = { controls: function () { var t = { autopostback: "autopostback" }, a = { inputFile: "input-file", autopostbackHF: "autopostback-hf" }, i = { inputFiltering: "input-filtering" }, o = { regex: "regex" }, r = { target: "click-target" }, s = { stateContainer: "toggle-state-container" }, l = { class: { input: "custom-file-input", label: "custom-file-label" }, dataAttr: { browse: "browse", browseWithPrefix: "data-browse", selectedFile: "selected-file", selectedFileWithPrefix: "data-selected-file" } }; function c(e) { $(e || "." + l.class.input).each((function () { var e = u($(this)); e.text(e.data(l.dataAttr.selectedFile)) })) } function u(e) { return e.siblings("." + l.class.label) } function d(e, t, n) { var a = $.extend({}, { emptyOptionText: null, selectAllByDefault: !1, destroyAndRecreateSelectpicker: !1, itemsValueProperty: "Value", itemsTextProperty: "Text", itemsSelectedProperty: "Selected", itemsSelectedValue: null }, n), i = $("#" + e); i.empty(), null != a.emptyOptionText && i.append('<option value="">' + a.emptyOptionText + "</option>"), $.each(t, (function (e, t) { var n = t[a.itemsValueProperty], o = a.itemsSelectedValue === n || !0 === t[a.itemsSelectedProperty]; i.append('<option value="' + n + '" ' + (o ? 'selected="selected"' : "") + ">" + t[a.itemsTextProperty] + "</option>") })); var o = i.hasClass(F.class.selectpicker), r = i.hasClass(A.class.multiselect); (o || r) && (a.destroyAndRecreateSelectpicker ? (i.selectpicker("destroy"), r ? I("#" + e, i.data(A.dataAttr.options)) : i.selectpicker()) : (i.selectpicker("val", i.val()).selectpicker("refresh"), a.selectAllByDefault && r && i.selectpicker("selectAll"))), i.trigger("change") } function m(e, t, n) { var a = $.extend({}, { loadingEnabled: !1, loadingSelector: null, itemsAddedCallback: null, ajaxItemsProperty: "items", ajaxErrorProperty: "error", ajaxErrorDefaultMessage: "An error occurred." }, n), i = $("#" + e); i.empty(), a.loadingEnabled && T(a.loadingSelector), $.getJSON(t, (function (t) { var n = t[a.ajaxErrorProperty]; if (n) return alert(n), void d(e, [], a); d(e, t[a.ajaxItemsProperty], a), a.itemsAddedCallback && a.itemsAddedCallback($("#" + e)) })).fail((function (e) { alert(a.ajaxErrorDefaultMessage) })).always((function () { a.loadingEnabled && w(a.loadingSelector), i.trigger("change") })) } var f = { intervalId: "elapsed-time-interval-id", minutesReachedTriggered: "elapsed-time-minutes-reached-triggered" }, p = { checkBoxSelection: "checkbox-selection" }, h = { sortable: "table-sortable", sortedNone: "sorted-none", sortedAsc: "sorted-asc", sortedDesc: "sorted-desc" }, g = { sort: "sort", sortValue: "sort-value", sortAsc: "sort-asc", noSort: "no-sort" }, v = { tableOrderPost: "table-order-post" }, b = { order: "order" }; function x(e, t, n, a) { bootbox.alert({ message: '<div class="mt-3 text-center text-' + t + '"><i class="fa ' + n + ' fa-2x"></i>    <div class="mt-1">' + e + "</div></div>", buttons: {}, callback: a }) } function k(e, t, n, a) { var i = $.extend({}, { buttons: {} }, a); bootbox.confirm({ title: e, message: t, buttons: i.buttons, callback: n }) } var y = { modal: '<div class="modal fade" id="{0}" tabindex="-1" role="dialog" aria-labelledby="{0}Label"  aria-hidden="true"><div class="modal-dialog" role="document" ><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="{0}Label"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"></div></div></div></div>' }, C = { height: "350px" }, S = { iframe: "iframe", title: "iframe-title", modalSize: "iframe-modal-size", height: "iframe-height", onHidden: "iframe-onhidden" }; function T(e) { var t = { image: "", fontawesome: "fa fa-spinner fa-spin", size: 15 }; e ? $(e).LoadingOverlay("show", t) : $.LoadingOverlay("show", t) } function w(e) { e ? $(e).LoadingOverlay("hide") : $.LoadingOverlay("hide") } var F = { class: { selectpicker: "selectpicker" } }, A = { class: { multiselect: "multiselect" }, dataAttr: { options: "multiselect-opts" } }; function I(t, n) { var a = $.extend({}, { maxIndividualOptions: 3, allSelectedText: "All", countSelectedTextFormat: "{0} of {1}" }, n); $(t || "." + A.class.multiselect).selectpicker({ actionsBox: !0, selectedTextFormat: "count > " + a.maxIndividualOptions, countSelectedText: function (t, n) { return t == n ? a.allSelectedText : e.stringFormat(a.countSelectedTextFormat, t, n) } }).data(A.dataAttr.options, a) } var M = { selectpickerAjax: "selectpicker-ajax" }, D = { datepicker: "datepicker" }, V = { characterCounter: "character-counter" }, P = { numeric: "numeric", numericInteger: "numeric-integer" }, E = { numeric: "inputmask-numeric", integer: "inputmask-integer" }; function R(e, t, n, a) { $(e, t).inputmask(n, a) } return { clearControls: function (e) { var t = $(e); t.filter("input, select, textarea").val(""), t.filter(":radio,:checkbox").prop("checked", !1), c(e) }, initAutopostback: function () { $("." + t.autopostback).on("change", (function () { var e = $(this), t = e.closest("form"), n = e.data("autopostback-hf"); if (n) { var a = n.split("="); 2 == a.length && t.append('<input type="hidden" name="' + a[0] + '" value="' + a[1] + '" />') } t.submit() })), $(document).on("change", e.stringFormat("input.{0},select.{0},textarea.{0}", t.autopostback), (function () { $(this).closest("form").submit() })) }, showAlert: function (e, t, n) { $(e).show().html(t).attr("class", "alert alert-" + n) }, hideAlert: function (e) { $(e).hide().empty().attr("class", "") }, initPrintButton: function () { $(".btn-print").on("click", (function (e) { return e.preventDefault(), n.print(), !1 })) }, initScrollFocus: function () { var e = $(".scroll-focus"); e.length > 0 && $([document.documentElement, document.body]).animate({ scrollTop: e.first().offset().top - 30 }, 1e3) }, initInputFileButtons: function () { $(e.stringFormat("input[data-{0}],button[data-{0}]", a.inputFile)).each((function () { var e = $(this), t = e.data(a.inputFile), n = $("#" + t); if (n.hasClass("d-none") || n.addClass("d-none"), e.attr("name")) { var i = e.attr("name"), o = e.attr("value"); n.data(a.autopostbackHF, i + "=" + o) } })).on("click", (function (e) { e.preventDefault(); var t = $(this).data(a.inputFile); return $("#" + t).click(), !1 })) }, initInputFiltering: function (e, t) { var n = $.extend({}, { pattern: null }, t); function a(e, t) { return new RegExp("[" + (1 == t ? "^" : "") + (e.data(o.regex) || n.pattern) + "]", "g") } $(e || "." + i.inputFiltering).on("keypress", (function (e) { a($(this)).test(String.fromCharCode(e.keyCode)) || e.preventDefault() })).on("input", (function () { var e = $(this), t = a(e, !0); e.val(e.val().replace(t, "")) })) }, initClickControls: function () { $(nmd.utils.stringFormat("[data-{0}]", r.target)).on("click", (function (e) { e.preventDefault(); var t = $(e.target).data(r.target); return t && $(t).click(), !1 })) }, initToggleStateControls: function () { $(nmd.utils.stringFormat("[data-{0}]", s.stateContainer)).each((function () { var e = $(this), t = e.data(s.stateContainer); function n() { e.prop("disabled", !nmd.ui.forms.validateRequiredControls(t)) } n(), $("." + nmd.ui.forms.formsConstants.class.formControlRequired, t).on("change", (function () { n() })), $(t).on("reset", (function () { setTimeout((function () { n() }), 50) })) })) }, initBootstrapTooltips: function () { $('[data-toggle="tooltip"]').tooltip() }, initBootstrapCustomFileInput: function (e, t) { var n, a, i = $.extend({}, { browseText: "Buscar", selectedFileText: "..." }, t); $(e || "." + l.class.input).each((function () { var e = u($(this)); n = e.attr(l.dataAttr.browseWithPrefix) || i.browseText, a = e.attr(l.dataAttr.selectedFileWithPrefix) || i.selectedFileText, e.attr(l.dataAttr.browseWithPrefix, n).attr(l.dataAttr.selectedFileWithPrefix, a).text(a) })), bsCustomFileInput.init() }, clearBootstrapCustomFileInput: c, loadCombo: d, loadComboAjax: m, initComboCascadeAjax: function (e, t, n, a) { var i = "#" + t.replace(",", ",#"); function o() { var e = !1, t = $(i).map((function () { var t = $(this), n = t.hasClass(A.class.multiselect) ? t.val().join(",") : t.val(); return n || (e = !0), n })).get(); return e ? null : nmd.utils.stringFormat(n, t) } $(i).on("change", (function () { o() ? m(e, o(), a) : d(e, [], a) })) }, initComboCascadeJson: function (e, t, n, a) { var i = $.extend({}, { comboSelectedValue: null, parentComboSelectedValue: null }, a), o = function (e) { for (var t = { items: [] }, n = "string" == typeof e ? JSON.parse(e) : e, a = n.length, i = 0, o = 0; o < a; o++) { t.items.push(n[o]), t[n[o].Value] = {}, i = n[o].Items.length, t[n[o].Value] = []; for (var r = 0; r < i; r++)t[n[o].Value].push(n[o].Items[r]) } return t }(n); function r(n) { var a = [], r = $("#" + t).val(); r && (a = o[r]), d(e, a, $.extend({}, i, { itemsSelectedValue: n })) } d(t, o.items, { itemsSelectedValue: i.parentComboSelectedValue }), r(i.comboSelectedValue), $("#" + t).on("change", (function () { r() })) }, initElapsedTime: function (e, t, n) { var a = $.extend({}, { minutesReachedValue: null, minutesReachedCallback: null }, n), i = $("#" + e); if (0 !== i.length) { var o = moment(t), r = setInterval((function () { i = $("#" + e); var t = moment() - o, n = moment.duration(t), r = n.asMinutes(); if (i.text(r < 60 ? moment(t).format("mm:ss") : n.humanize()), a.minutesReachedValue && a.minutesReachedCallback && r > a.minutesReachedValue && !i.data(f.minutesReachedTriggered)) { try { a.minutesReachedCallback() } catch (e) { } i.data(f.minutesReachedTriggered, !0) } }), 800); i.data(f.intervalId, r) } }, stopElapsedTime: function (e) { var t = $("#" + e).data(f.intervalId); t && clearInterval(parseInt(t)) }, initTableCheckBoxSelection: function (e) { var t = "thead input[type=checkbox]", n = "tbody input[type=checkbox]", a = (e = e || "." + p.checkBoxSelection) + " " + t, i = e + " " + n; function o() { 0 != $(i).length && r($(a), 0 == $(i + ":not(:checked)").length) } function r(e, t) { e.prop("checked", t) } o(), $(e).on("change", t, (function (e) { r($(i), $(this).is(":checked")) })), $(e).on("change", n, (function (e) { o() })) }, initTableSorting: function (t) { t = t || "." + h.sortable; var n = e.stringFormat("th:not([data-{0}])", g.noSort); function a(t, n) { var a = t.find(e.stringFormat("td:nth-child({0})", n + 1)); return a.data(g.sortValue) || a.text() } function i(e, a) { var i = $(t + " " + n); i.removeClass(h.sortedNone).removeClass(h.sortedAsc).removeClass(h.sortedDesc), i.addClass(h.sortedNone), e && 1 == e.length && e.removeClass(h.sortedNone).addClass(a ? h.sortedAsc : h.sortedDesc).data(g.sortAsc, a ? "0" : "1") } i(), $(t).on("click", n, (function () { var e = $(this), n = $(t).find("tbody"), o = e.index(), r = "1" === (e.data(g.sortAsc) || "1"); n.find("tr").sort((function (e, t) { var n = a($(e), o).localeCompare(a($(t), o)); return r ? n : -n })).appendTo(n), i(e, r) })) }, initTableOrderPOST: function (t, n) { var a = $.extend({}, { orderInputName: "Order" }, n); t = t || "." + v.tableOrderPost; var i = e.stringFormat("th[data-{0}]", b.order); $(t).on("click", i, (function () { var e = $(this), t = e.closest("form"), n = e.data(b.order); t.append('<input type="hidden" name="' + a.orderInputName + '" value="' + n + '" />').submit() })) }, initModals: function (e) { var t = $.extend({}, { locale: "es", swapButtonOrder: !0 }, e); bootbox.setDefaults(t) }, showErrorModal: function (e, t) { x(e, "danger", "fa-times-circle", t) }, showSuccessModal: function (e, t) { x(e, "success", "fa-check-circle", t) }, showMessageModal: x, showConfirmModal: k, initIframeModalsLinks: function () { $(e.stringFormat("a[data-{0}]", S.iframe)).each((function () { var t = $(this), n = "mdIframe" + Math.floor(99999 * Math.random()), a = "#" + n; 0 == $(a).length && $("body").append(e.stringFormat(y.modal, n)), t.attr("data-toggle", "modal").attr("data-target", a), $(a).on("shown.bs.modal", (function () { var e = $(this), n = t.data(S.title) || "", a = t.data(S.modalSize); e.find(".modal-title").html(n), a && (a = "modal-" + a), e.find(".modal-dialog").attr("class", "modal-dialog " + a), e.find(".modal-body").empty().append('<iframe src="' + t.prop("href") + '" class="border-0 w-100" style="height: ' + (t.data(S.height) || C.height) + '"></iframe>') })).on("hidden.bs.modal", (function (e) { if ($(this).find(".modal-body").empty(), t.data(S.onHidden)) { for (var n = window, a = t.data(S.onHidden).split("."), i = a.pop(), o = 0; o < a.length; o++)n = n[a[o]]; return n[i].apply(n, [e, t]) } })) })) }, initSessionTimeoutCheck: function (e) { var t, n = $.extend({}, { timeoutInMin: 10, timeoutAlertInMin: 1, checkSessionUrl: "/Home/CheckSession", extendSessionUrl: "/Home/ExtendSession", sessionExpiredUrl: "/Home/SessionExpired", confirmModalTitle: "Session", confirmModalMessage: "Your session is expiring soon.", confirmModalExtendSessionButton: "Extend session" }, e), a = 6e4 * n.timeoutInMin, i = a - 6e4 * n.timeoutAlertInMin; function o() { t && clearTimeout(t), t = setTimeout((function () { $.getJSON(n.checkSessionUrl, (function (e) { !1 === e.authenticated ? window.location = n.sessionExpiredUrl : o() })) }), a) } o(), function e() { setTimeout((function () { k(n.confirmModalTitle, n.confirmModalMessage, (function (t) { t && $.post(n.extendSessionUrl, nmd.ui.forms.createDataWithAntiForgeryToken(), (function () { o(), e() })) }), { buttons: { confirm: { label: n.confirmModalExtendSessionButton, className: "btn-primary" }, cancel: { className: "d-none" } } }) }), i) }() }, showLoading: T, hideLoading: w, initMultiSelect: I, initSelectpickerAjax: function (e, t) { var n = $.extend({}, { minLength: 3, preserveSelected: !1 }, t); $(e || "." + M.selectpickerAjax).selectpicker({ liveSearch: !0 }).ajaxSelectPicker(n) }, initDatePicker: function (e, t) { var n = $.extend({}, { maxViewMode: 2, todayBtn: "linked", clearBtn: !0, autoclose: !0 }, t); $(e || "." + D.datepicker).datepicker(n).on("hide", (function (e) { e.stopPropagation() })) }, initCharacterCounter: function (e, t) { var n = $.extend({}, { renderTotal: !0, countNewLineChars: !1, counterWrapper: "small", counterCssClass: "float-right", counterFormat: "%1", counterExceededCssClass: "text-danger" }, t); $(e || "." + V.characterCounter).characterCounter(n) }, initNumeric: function (e, t) { var n = $.extend({}, { decimal: ".", negative: !1, decimalPlaces: -1 }, t); $(e || "." + P.numeric).numeric(n) }, initNumericInteger: function (e, t) { var n = $.extend({}, { negative: !1 }, t); $(e || "." + P.numericInteger).numeric({ decimal: !1, negative: n.negative }) }, initInputMaskNumeric: function (e, t, n) { var a = $.extend({}, { groupSeparator: ",", digits: 2, rightAlign: !0 }, t); R(e || "." + E.numeric, n, "numeric", a) }, initInputMaskInteger: function (e, t, n) { var a = $.extend({}, { groupSeparator: ",", rightAlign: !0 }, t); R(e || "." + E.integer, n, "integer", a) }, getInputMaskValue: function (e, t) { return $(e, t).inputmask("unmaskedvalue") } } }(), forms: function () { function e(e, t) { e.__RequestVerificationToken = $("input[name=__RequestVerificationToken]", t).val() } var t = { class: { formControlRequired: "form-control-required" } }; return { setAntiForgeryTokenToData: e, createDataWithAntiForgeryToken: function (t) { var n = {}; return e(n, t), n }, setAntiForgeryTokenToFormData: function (e, t) { e.append("__RequestVerificationToken", $("input[name=__RequestVerificationToken]", t).val()) }, disableEnterSubmit: function () { $(document).on("keydown", ":input:not(textarea)", (function (e) { return "Enter" != e.key })) }, initDisableOnSubmitButtons: function () { var e = ".disable-on-submit", t = "disabled-on-submit"; $(document).on("invalid-form.validate", "form", (function () { var n = $(this).find(e + " ." + t); setTimeout((function () { n.prop("disabled", !1).removeClass(t) }), 1) })), $(document).on("submit", "form", (function () { var n = $(this).find(e); setTimeout((function () { n.prop("disabled", !0).addClass(t) }), 0) })) }, setValidationSummaryVisibility: function () { 0 === $(".validation-summary-errors li:visible").length && $(".validation-summary-errors").hide() }, formsConstants: t, validateRequiredControls: function (e) { var n = !1; return $("." + t.class.formControlRequired, e).each((function () { $(this).val().trim() || (n = !0) })), !n } } }() }; return { utils: e, format: t, page: n, ui: a } }();