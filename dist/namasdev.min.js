/*!
 * namasdev JS
 *
 * @version 1.0.0
 * @author Matias Lopez - https://github.com/MatiasALopez
 * @link https://github.com/MatiasALopez/namasdev.Web.JS
 * @copyright 2024 Matias Lopez
 * @license Released under the MIT license.
 */
"use strict"; var nmd = function () { var t, e, a = { stringFormat: function t(e, ...a) { if (!e) return e; for (var n = $.isArray(a[0]) ? a[0] : a, i = 0; i < n.length; i++)e = e.replace(RegExp("\\{" + i + "\\}", "gm"), n[i]); return e }, repeatString: function t(e, a) { for (var n = ""; a > 0;)n += e, a--; return n }, throttle: function t(e, a, n) { var i, r, o, s = null, l = 0; n || (n = {}); var c = function () { l = !1 === n.leading ? 0 : Date.now(), s = null, o = e.apply(i, r), s || (i = r = null) }; return function () { var t = Date.now(); l || !1 !== n.leading || (l = t); var d = a - (t - l); return i = this, r = arguments, d <= 0 || d > a ? (s && (clearTimeout(s), s = null), l = t, o = e.apply(i, r), s || (i = r = null)) : s || !1 === n.trailing || (s = setTimeout(c, d)), o } }, round: function t(e, a) { var n = Math.pow(10, a || 0); return Math.round(e * n) / n }, createDateTimeFromUnixTimestamp: function t(e) { return new Date(parseInt(e.match(/\d+/g)[0])) } }, n = function () { var t = "es-ES", e = "2-digit", a = "2-digit"; function n(a) { return new Date(a).toLocaleDateString(t, { year: "numeric", month: e, day: e }) } function i(e) { return new Date(e).toLocaleTimeString(t, { hour: a, minute: a, hour12: !1 }) } return { formatDate: n, formatTime: i, formatDateTime: function t(e) { return n(e) + " " + i(e) }, formatNumber: function t(e, a) { return numeral(e).format("0,0." + nmd.utils.repeatString("0", a)) } } }(), i = { print: function t() { window.print() }, getQueryStringObject: function t() { var e, a = window.location.search.slice(1).split("&"), n = {}, i = a.length; if (window.location.search && i) for (var r = 0; r < i; r++)2 == (e = a[r].split("=")).length && (n[e[0]] = decodeURIComponent(e[1] || "")); return n }, reloadPage: function t() { window.location = window.location }, isSmallScreen: function t() { return window.matchMedia("(max-width: 767px)").matches }, disableF5Refresh: function t() { $(document).on("keydown", function (t) { return 116 != (t.which || t.keyCode) }) }, disableCopyAndPaste: function t(e) { $(e || document).on("cut copy paste", function (t) { return t.preventDefault(), !1 }) } }, r = (t = function () { var t = { class: { autopostback: "autopostback" } }, e = { dataAttr: { inputFile: "input-file", autopostbackHF: "autopostback-hf" } }, n = { class: { inputFiltering: "input-filtering" }, dataAttr: { regex: "regex" } }, r = { dataAttr: { target: "click-target" } }, o = { dataAttr: { stateContainer: "toggle-state-container" } }, s = { class: { input: "custom-file-input", label: "custom-file-label" }, dataAttr: { browse: "browse", browseWithPrefix: "data-browse", selectedFile: "selected-file", selectedFileWithPrefix: "data-selected-file" } }; function l(t) { $(t || "." + s.class.input).each(function () { var t = c($(this)); t.text(t.data(s.dataAttr.selectedFile)) }) } function c(t) { return t.siblings("." + s.class.label) } function d(t, e, a) { var n = $.extend({}, { emptyOptionText: null, selectAllByDefault: !1, destroyAndRecreateSelectpicker: !1, itemsValueProperty: "Value", itemsTextProperty: "Text", itemsSelectedProperty: "Selected", itemsSelectedValue: null }, a), i = $("#" + t); i.empty(), null != n.emptyOptionText && i.append('<option value="">' + n.emptyOptionText + "</option>"), $.each(e, function (t, e) { var a = e[n.itemsValueProperty], r = n.itemsSelectedValue === a || !0 === e[n.itemsSelectedProperty]; i.append('<option value="' + a + '" ' + (r ? 'selected="selected"' : "") + ">" + e[n.itemsTextProperty] + "</option>") }); var r = i.hasClass(A.class.selectpicker), o = i.hasClass(y.class.multiselect); (r || o) && (n.destroyAndRecreateSelectpicker ? (i.selectpicker("destroy"), o ? S("#" + t, i.data(y.dataAttr.options)) : i.selectpicker()) : (i.selectpicker("val", i.val()).selectpicker("refresh"), n.selectAllByDefault && o && i.selectpicker("selectAll"))), i.trigger("change") } function u(t, e, a) { var n = $.extend({}, { loadingEnabled: !1, loadingSelector: null, itemsAddedCallback: null, ajaxItemsProperty: "items", ajaxErrorProperty: "error", ajaxErrorDefaultMessage: "An error occurred." }, a), i = $("#" + t); i.empty(), n.loadingEnabled && x(n.loadingSelector), $.getJSON(e, function (e) { var a = e[n.ajaxErrorProperty]; if (a) { alert(a), d(t, [], n); return } d(t, e[n.ajaxItemsProperty], n), n.itemsAddedCallback && n.itemsAddedCallback($("#" + t)) }).fail(function (t) { alert(n.ajaxErrorDefaultMessage) }).always(function () { n.loadingEnabled && k(n.loadingSelector), i.trigger("change") }) } var m = { dataAttr: { intervalId: "elapsed-time-interval-id", minutesReachedTriggered: "elapsed-time-minutes-reached-triggered" } }, f = { class: { checkBoxSelection: "checkbox-selection" } }, p = { class: { sortable: "table-sortable", sortedNone: "sorted-none", sortedAsc: "sorted-asc", sortedDesc: "sorted-desc" }, dataAttr: { sort: "sort", sortValue: "sort-value", sortAsc: "sort-asc", noSort: "no-sort" } }, h = { class: { tableOrderPost: "table-order-post" }, dataAttr: { order: "order" } }; function g(t, e, a, n) { bootbox.alert({ message: '<div class="mt-3 text-center text-' + e + '"><i class="fa ' + a + ' fa-2x"></i>    <div class="mt-1">' + t + "</div></div>", buttons: {}, callback: n }) } function v(t, e, a, n) { var i = $.extend({}, { buttons: {} }, n); bootbox.confirm({ title: t, message: e, buttons: i.buttons, callback: a }) } var b = { templates: { modal: '<div class="modal fade" id="{0}" tabindex="-1" role="dialog" aria-labelledby="{0}Label"  aria-hidden="true"><div class="modal-dialog" role="document" ><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="{0}Label"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"></div></div></div></div>' }, defaults: { height: "350px" }, dataAttr: { iframe: "iframe", title: "iframe-title", modalSize: "iframe-modal-size", height: "iframe-height", onHidden: "iframe-onhidden" } }; function x(t) { var e = { image: "", fontawesome: "fa fa-spinner fa-spin", size: 15 }; t ? $(t).LoadingOverlay("show", e) : $.LoadingOverlay("show", e) } function k(t) { t ? $(t).LoadingOverlay("hide") : $.LoadingOverlay("hide") } var A = { class: { selectpicker: "selectpicker" } }, y = { class: { multiselect: "multiselect" }, dataAttr: { options: "multiselect-opts" } }; function S(t, e) { var n = $.extend({}, { maxIndividualOptions: 3, allSelectedText: "All", countSelectedTextFormat: "{0} of {1}" }, e); $(t || "." + y.class.multiselect).selectpicker({ actionsBox: !0, selectedTextFormat: "count > " + n.maxIndividualOptions, countSelectedText: function (t, e) { return t == e ? n.allSelectedText : a.stringFormat(n.countSelectedTextFormat, t, e) } }).data(y.dataAttr.options, n) } var C = { class: { selectpickerAjax: "selectpicker-ajax" } }, T = { class: { datepicker: "datepicker" } }, _ = { class: { characterCounter: "character-counter" } }, F = { class: { numeric: "numeric", numericInteger: "numeric-integer" } }, w = { class: { numeric: "inputmask-numeric", integer: "inputmask-integer" } }; function I(t, e, a, n) { $(t, e).inputmask(a, n) } return { clearControls: function t(e) { var a = $(e); a.filter("input, select, textarea").val(""), a.filter(":radio,:checkbox").prop("checked", !1), l(e) }, initAutopostback: function e() { $("." + t.class.autopostback).on("change", function () { var t = $(this), e = t.closest("form"), a = t.data("autopostback-hf"); if (a) { var n = a.split("="); 2 == n.length && e.append('<input type="hidden" name="' + n[0] + '" value="' + n[1] + '" />') } e.submit() }), $(document).on("change", a.stringFormat("input.{0},select.{0},textarea.{0}", t.class.autopostback), function () { $(this).closest("form").submit() }) }, showAlert: function t(e, a, n) { $(e).show().html(a).attr("class", "alert alert-" + n) }, hideAlert: function t(e) { $(e).hide().empty().attr("class", "") }, initPrintButton: function t() { $(".btn-print").on("click", function (t) { return t.preventDefault(), i.print(), !1 }) }, initScrollFocus: function t() { var e = $(".scroll-focus"); e.length > 0 && $([document.documentElement, document.body]).animate({ scrollTop: e.first().offset().top - 30 }, 1e3) }, initInputFileButtons: function t() { $(a.stringFormat("input[data-{0}],button[data-{0}]", e.dataAttr.inputFile)).each(function () { var t = $(this), a = $("#" + t.data(e.dataAttr.inputFile)); if (a.hasClass("d-none") || a.addClass("d-none"), t.attr("name")) { var n = t.attr("name"), i = t.attr("value"); a.data(e.dataAttr.autopostbackHF, n + "=" + i) } }).on("click", function (t) { t.preventDefault(); var a = $(this).data(e.dataAttr.inputFile); return $("#" + a).click(), !1 }) }, initInputFiltering: function t(e, a) { var i = $.extend({}, { pattern: null }, a); function r(t, e) { return RegExp("[" + (!0 == e ? "^" : "") + (t.data(n.dataAttr.regex) || i.pattern) + "]", "g") } $(e || "." + n.class.inputFiltering).on("keypress", function (t) { r($(this)).test(String.fromCharCode(t.keyCode)) || t.preventDefault() }).on("input", function () { var t = $(this), e = r(t, !0); t.val(t.val().replace(e, "")) }) }, initClickControls: function t() { $(nmd.utils.stringFormat("[data-{0}]", r.dataAttr.target)).on("click", function (t) { t.preventDefault(); var e = $(t.target).data(r.dataAttr.target); return e && $(e).click(), !1 }) }, initToggleStateControls: function t() { $(nmd.util.stringFormat("[data-{0}]", o.dataAttr.stateContainer)).each(function () { var t = $(this), e = t.data(o.dataAttr.stateContainer); function a() { t.prop("disabled", !nmd.ui.forms.validateRequiredControls(e)) } a(), $("." + nmd.ui.forms.formsConstants.class.formControlRequired, e).on("change", function () { a() }) }) }, initBootstrapTooltips: function t() { $('[data-toggle="tooltip"]').tooltip() }, initBootstrapCustomFileInput: function t(e, a) { var n, i, r = $.extend({}, { browseText: "Buscar", selectedFileText: "..." }, a); $(e || "." + s.class.input).each(function () { var t = c($(this)); n = t.attr(s.dataAttr.browseWithPrefix) || r.browseText, i = t.attr(s.dataAttr.selectedFileWithPrefix) || r.selectedFileText, t.attr(s.dataAttr.browseWithPrefix, n).attr(s.dataAttr.selectedFileWithPrefix, i).text(i) }), bsCustomFileInput.init() }, clearBootstrapCustomFileInput: l, loadCombo: d, loadComboAjax: u, initComboCascadeAjax: function t(e, a, n, i) { var r = "#" + a.replace(",", ",#"); function o() { var t = !1, e = $(r).map(function () { var e = $(this), a = e.hasClass(y.class.multiselect) ? e.val().join(",") : e.val(); return a || (t = !0), a }).get(); return t ? null : nmd.utils.stringFormat(n, e) } $(r).on("change", function () { if (!o()) { d(e, [], i); return } u(e, o(), i) }) }, initComboCascadeJson: function t(e, a, n, i) { var r = $.extend({}, { comboSelectedValue: null, parentComboSelectedValue: null }, i), o = function t(e) { for (var a = { items: [] }, n = "string" == typeof e ? JSON.parse(e) : e, i = n.length, r = 0, o = 0; o < i; o++) { a.items.push(n[o]), a[n[o].Value] = {}, r = n[o].Items.length, a[n[o].Value] = []; for (var s = 0; s < r; s++)a[n[o].Value].push(n[o].Items[s]) } return a }(n); function s(t) { var n = [], i = $("#" + a).val(); i && (n = o[i]), d(e, n, $.extend({}, r, { itemsSelectedValue: t })) } d(a, o.items, { itemsSelectedValue: r.parentComboSelectedValue }), s(r.comboSelectedValue), $("#" + a).on("change", function () { s() }) }, initElapsedTime: function t(e, a, n) { var i = $.extend({}, { minutesReachedValue: null, minutesReachedCallback: null }, n), r = $("#" + e); if (0 !== r.length) { var o = moment(a), s = null, l = setInterval(function () { r = $("#" + e); var t = (s = moment()) - o, a = moment.duration(t), n = a.asMinutes(); if (r.text(n < 60 ? moment(t).format("mm:ss") : a.humanize()), i.minutesReachedValue && i.minutesReachedCallback && n > i.minutesReachedValue && !r.data(m.dataAttr.minutesReachedTriggered)) { try { i.minutesReachedCallback() } catch (l) { } r.data(m.dataAttr.minutesReachedTriggered, !0) } }, 800); r.data(m.dataAttr.intervalId, l) } }, stopElapsedTime: function t(e) { var a = $("#" + e).data(m.dataAttr.intervalId); a && clearInterval(parseInt(a)) }, initTableCheckBoxSelection: function t(e) { e = e || "." + f.class.checkBoxSelection; var a = "thead input[type=checkbox]", n = "tbody input[type=checkbox]", i = e + " " + a, r = e + " " + n; function o() { 0 != $(r).length && s($(i), 0 == $(r + ":not(:checked)").length) } function s(t, e) { t.prop("checked", e) } o(), $(e).on("change", a, function (t) { s($(r), $(this).is(":checked")) }), $(e).on("change", n, function (t) { o() }) }, initTableSorting: function t(e) { e = e || "." + p.class.sortable; var n = a.stringFormat("th:not([data-{0}])", p.dataAttr.noSort); function i(t, e) { var n = t.find(a.stringFormat("td:nth-child({0})", e + 1)); return n.data(p.dataAttr.sortValue) || n.text() } function r(t, a) { var i = $(e + " " + n); i.removeClass(p.class.sortedNone).removeClass(p.class.sortedAsc).removeClass(p.class.sortedDesc), i.addClass(p.class.sortedNone), t && 1 == t.length && t.removeClass(p.class.sortedNone).addClass(a ? p.class.sortedAsc : p.class.sortedDesc).data(p.dataAttr.sortAsc, a ? "0" : "1") } r(), $(e).on("click", n, function () { var t = $(this), a = $(e).find("tbody"), n = t.index(), o = "1" === (t.data(p.dataAttr.sortAsc) || "1"); a.find("tr").sort(function (t, e) { var a = i($(t), n).localeCompare(i($(e), n)); return o ? a : -a }).appendTo(a), r(t, o) }) }, initTableOrderPOST: function t(e, n) { var i = $.extend({}, { orderInputName: "Order" }, n); e = e || "." + h.class.tableOrderPost; var r = a.stringFormat("th[data-{0}]", h.dataAttr.order); $(e).on("click", r, function () { var t = $(this), e = t.closest("form"), a = t.data(h.dataAttr.order); e.append('<input type="hidden" name="' + i.orderInputName + '" value="' + a + '" />').submit() }) }, initModals: function t(e) { var a = $.extend({}, { locale: "es", swapButtonOrder: !0 }, e); bootbox.setDefaults(a) }, showErrorModal: function t(e, a) { g(e, "danger", "fa-times-circle", a) }, showSuccessModal: function t(e, a) { g(e, "success", "fa-check-circle", a) }, showMessageModal: g, showConfirmModal: v, initIframeModalsLinks: function t() { $(a.stringFormat("a[data-{0}]", b.dataAttr.iframe)).each(function () { var t = $(this), e = "mdIframe" + Math.floor(99999 * Math.random()), n = "#" + e; 0 == $(n).length && $("body").append(a.stringFormat(b.templates.modal, e)), t.attr("data-toggle", "modal").attr("data-target", n), $(n).on("shown.bs.modal", function () { var e = $(this), a = t.data(b.dataAttr.title) || "", n = t.data(b.dataAttr.modalSize); e.find(".modal-title").html(a), n && (n = "modal-" + n), e.find(".modal-dialog").attr("class", "modal-dialog " + n), e.find(".modal-body").empty().append('<iframe src="' + t.prop("href") + '" class="border-0 w-100" style="height: ' + (t.data(b.dataAttr.height) || b.defaults.height) + '"></iframe>') }).on("hidden.bs.modal", function (e) { if ($(this).find(".modal-body").empty(), t.data(b.dataAttr.onHidden)) { for (var a = window, n = t.data(b.dataAttr.onHidden).split("."), i = n.pop(), r = 0; r < n.length; r++)a = a[n[r]]; return a[i].apply(a, [e, t]) } }) }) }, initSessionTimeoutCheck: function t(e) { var a, n = $.extend({}, { timeoutInMin: 10, timeoutAlertInMin: 1, checkSessionUrl: "/Home/CheckSession", extendSessionUrl: "/Home/ExtendSession", sessionExpiredUrl: "/Home/SessionExpired", confirmModalTitle: "Session", confirmModalMessage: "Your session is expiring soon.", confirmModalExtendSessionButton: "Extend session" }, e), i = 6e4 * n.timeoutInMin, r = i - 6e4 * n.timeoutAlertInMin; function o() { a && clearTimeout(a), a = setTimeout(function () { $.getJSON(n.checkSessionUrl, function (t) { !1 === t.authenticated ? window.location = n.sessionExpiredUrl : o() }) }, i) } o(), function t() { setTimeout(function () { v(n.confirmModalTitle, n.confirmModalMessage, function (e) { e && $.post(n.extendSessionUrl, nmd.ui.forms.createDataWithAntiForgeryToken(), function () { o(), t() }) }, { buttons: { confirm: { label: n.confirmModalExtendSessionButton, className: "btn-primary" }, cancel: { className: "d-none" } } }) }, r) }() }, showLoading: x, hideLoading: k, initMultiSelect: S, initSelectpickerAjax: function t(e, a) { var n = $.extend({}, { minLength: 3, preserveSelected: !1 }, a); $(e || "." + C.class.selectpickerAjax).selectpicker({ liveSearch: !0 }).ajaxSelectPicker(n) }, initDatePicker: function t(e, a) { var n = $.extend({}, { maxViewMode: 2, todayBtn: "linked", clearBtn: !0, autoclose: !0 }, a); $(e || "." + T.class.datepicker).datepicker(n).on("hide", function (t) { t.stopPropagation() }) }, initCharacterCounter: function t(e, a) { var n = $.extend({}, { renderTotal: !0, countNewLineChars: !1, counterWrapper: "small", counterCssClass: "float-right", counterFormat: "%1", counterExceededCssClass: "text-danger" }, a); $(e || "." + _.class.characterCounter).characterCounter(n) }, initNumeric: function t(e, a) { var n = $.extend({}, { decimal: ".", negative: !1, decimalPlaces: -1 }, a); $(e || "." + F.class.numeric).numeric(n) }, initNumericInteger: function t(e, a) { var n = $.extend({}, { negative: !1 }, a); $(e || "." + F.class.numericInteger).numeric({ decimal: !1, negative: n.negative }) }, initInputMaskNumeric: function t(e, a, n) { var i = $.extend({}, { groupSeparator: ",", digits: 2, rightAlign: !0 }, a); I(e || "." + w.class.numeric, n, "numeric", i) }, initInputMaskInteger: function t(e, a, n) { var i = $.extend({}, { groupSeparator: ",", rightAlign: !0 }, a); I(e || "." + w.class.integer, n, "integer", i) }, getInputMaskValue: function t(e, a) { return $(e, a).inputmask("unmaskedvalue") } } }(), e = function () { function t(t, e) { t.__RequestVerificationToken = $("input[name=__RequestVerificationToken]", e).val() } var e = { class: { formControlRequired: "form-control-required" } }; return { setAntiForgeryTokenToData: t, createDataWithAntiForgeryToken: function e(a) { var n = {}; return t(n, a), n }, setAntiForgeryTokenToFormData: function t(e, a) { e.append("__RequestVerificationToken", $("input[name=__RequestVerificationToken]", a).val()) }, disableEnterSubmit: function t() { $(document).on("keydown", ":input:not(textarea)", function (t) { return "Enter" != t.key }) }, initDisableOnSubmitButtons: function t() { var e = ".disable-on-submit", a = "disabled-on-submit"; $(document).on("invalid-form.validate", "form", function () { var t = $(this).find(e + " ." + a); setTimeout(function () { t.prop("disabled", !1).removeClass(a) }, 1) }), $(document).on("submit", "form", function () { var t = $(this).find(e); setTimeout(function () { t.prop("disabled", !0).addClass(a) }, 0) }) }, setValidationSummaryVisibility: function t() { 0 === $(".validation-summary-errors li:visible").length && $(".validation-summary-errors").hide() }, formsConstants: e, validateRequiredControls: function t(a) { var n = !1; return $("." + e.class.formControlRequired, a).each(function () { $(this).val().trim() || (n = !0) }), !n } } }(), { controls: t, forms: e }); return { utils: a, format: n, page: i, ui: r } }();